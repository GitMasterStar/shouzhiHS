<div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
        <div class="page-title">

            <div class="title_left">
                <h3>数据字典管理</h3>
            </div>

            <div class="title_right">
                <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search for...">
                        <span class="input-group-btn">
                      <button class="btn btn-default" type="button">Go!</button>
                    </span>
                    </div>
                </div>
            </div>
        </div>
        <!--<div class="clearfix"> </div>-->

        <div class="row">
            <div class="col-md-12">
                <div class="x_panel">
                    <!--<div class="x_title">
                        <h2>Inbox Design<small>User Mail</small></h2>
                        <ul class="nav navbar-right panel_toolbox">
                            <li><a class="btn parameter-add"><i class="fa fa-plus"></i> 添加</a>
                            </li>
                            <li>
                                <a class="btn parameter-update"><i class="fa fa-wrench"></i> 修改</a>
                            </li>
                            <li><a class="btn parametern-delete"><i class="fa fa-close"></i> 删除</a>
                            </li>
                        </ul>
                        <div class="clearfix"></div>
                    </div>-->
                    <div class="x_content">
                        <div class="row">
                            <div class="col-sm-3 mail_list_column">
                                <!--<button id="compose" class="btn btn-sm btn-success btn-block" type="button">刷新</button>-->
                                <div class="btn-group navbar-right">
                                    <!--<ul class="nav navbar-right panel_toolbox">
                                        <li><a class="btn btn-sm btn-primary parameter-add"><i class="fa fa-plus"></i> 添加</a>
                                        <a class="btn btn-sm btn-default parameter-update"><i class="fa fa-wrench"></i> 修改</a>
                                        <a class="btn btn-sm btn-default parametern-delete"><i class="fa fa-close"></i> 删除</a></li>
                                    </ul>-->

                                    <button class="btn btn-sm btn-primary parameter-add" value="你猜" type="button"><i class="fa fa-plus"></i> 添加</button>
                                    <button class="btn btn-sm btn-default" type="button"  data-placement="top" data-toggle="tooltip" data-original-title="Forward"><i class="fa fa-wrench"></i> 修改</button>
                                    <button class="btn btn-sm btn-default" type="button" data-placement="top" data-toggle="tooltip" data-original-title="Trash"><i class="fa fa-trash-o"></i> 删除</button>
                                </div>
                                <a class="cs" href="javascript:;" onclick="doFindPageObjects()" >点我显示遮罩层</a><br />
                                <br>
                                    <div class="layui-layer-content" style="height: 358px;">
                                        <div style="padding: 10px;" class="layui-layer-wrap">
                                            <ul id="zTreeId" class="ztree"></ul>
                                            <!-- 动态加载树 -->
                                        </div>
                                    </div>

                            </div>
                            <!-- /MAIL LIST -->

                            <!-- CONTENT MAIL -->
                            <div class="col-sm-9 mail_view">
                                <div class="inbox-body">
                                    <div class="mail_heading row">
                                        <div class="col-md-8">
                                            <div class="btn-group">
                                                <button class="btn btn-sm btn-primary" value="你猜" type="button"><i class="fa fa-plus"></i> 添加</button>
                                                <button class="btn btn-sm btn-default" type="button"  data-placement="top" data-toggle="tooltip" data-original-title="Forward"><i class="fa fa-wrench"></i> 修改</button>
                                                <button class="btn btn-sm btn-default" type="button" data-placement="top" data-toggle="tooltip" data-original-title="Trash"><i class="fa fa-trash-o"></i> 删除</button>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-right">
                                            <p class="date"> 8:02 PM 12 FEB 2014</p>
                                        </div>
                                        <!--<div class="col-md-12">
                                            <h4> Donec vitae leo at sem lobortis porttitor eu consequat risus. Mauris sed congue orci. Donec ultrices faucibus rutrum.</h4>
                                        </div>-->
                                    </div>
                                    <div class="x_content">
                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th><input type="checkbox" id="checkAllId"></th>
                                                <th width='20%'>编号</th>
                                                <th width='20%'>名称</th>
                                                <th width='40%'>描述</th>
                                            </tr>
                                            </thead>
                                            <tbody id="tbodyId">

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- /CONTENT MAIL -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- zTree 对应的div -->
    <div class="layui-layer layui-layer-page layui-layer-molv layer-anim"
         id="menuLayer" type="page" times="2" showtime="0" contype="object"
         style="z-index: 59891016; width: 500px; height: 450px; top: 15%; left:20%; display: none">
        <div class="layui-layer-title" style="cursor: move;">添加数据字典</div>
        <div class="layui-layer-content" style="height: 358px;">
            <form class="form-horizontal">
                <div class="box-body">
                    <br>
                    <div class="form-group">
                        <label for="nameId" class="col-sm-2 control-label wbcd">类型</label>
                        <div class="col-sm-10 typeRadio">
                            <label class="radio-inline"> <input type="radio" name="typeId" value="1" checked> 父级 </label>
                            <label class="radio-inline"> <input type="radio" name="typeId" value="2"> 子级 </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="nameId" class="col-sm-2 control-label wbcd">名称</label>

                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="name" id="nameId" placeholder="名称">
                        </div>
                    </div>
                    <div id="fj" class="form-group" style="display: none;">
                        <label class="col-sm-2 control-label wbcd">父级</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="name" id="pid" readonly="readonly" placeholder="父级">
                            <div style="display:none;border:0 solid;width:100%;float: left;" class="parameterTree">
                                <ul id="parameterTree" class="ztree"></ul>
                                <!-- 动态加载树 -->
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="ext1" class="col-sm-2 control-label wbcd">描述</label>

                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="note" id="ext1" placeholder="描述">
                        </div>
                    </div>
                </div>
                <!-- /.box-body -->
                <!--<div class="box-footer layui-layer-btn layui-layer-btn-">
                    <a class="layui-layer-btn0 btn-confirm">确定</a>
                    <a class="layui-layer-btn1 btn-cancel">取消</a>
                </div>-->
                <!-- /.box-footer -->
            </form>
        </div>
        <span class="layui-layer-setwin"> <a
                class="layui-layer-ico layui-layer-close layui-layer-close1 btn-cancel"></a></span>
        <div class="layui-layer-btn layui-layer-btn-">
            <a class="layui-layer-btn0 btn-confirm">确定</a>
            <a class="layui-layer-btn1 btn-cancel">取消</a>
        </div>
    </div>
</div>

<script type="text/javascript" src="bower_components/ztree/jquery.ztree.all.min.js"></script>
<script type="text/javascript" src="bower_components/layer/layer.js"></script>
<script type="text/javascript">
    var zTree;
    //初始化zTree时会用到
    var setting = {
        data : {
            simpleData : {
                enable : true,
                idKey : "id", //节点数据中保存唯一标识的属性名称
                pIdKey : "pid", //节点数据中保存其父节点唯一标识的属性名称
                rootPId : null
                //根节点id
            }
            //json 格式javascript对象
        },
        callback:{
            onClick:zTreeOnClick
        }
    }//json 格式的javascript对象

    $(function () {
        //加载初始数据列表
        doGetObjects();
        //显示右边列表数据为空
        doFindNull();
        //单击按钮事件
        $(".x_content").on("click",".btn-block",doGetObjects);
        $(".mail_list_column").on("click",".parameter-add",doFindPageObjects);
        $('#menuLayer')
            .on('click','.btn-cancel',doHidePage)
            .on('click','input:radio[name="typeId"]:checked',doSXinput)
            .on('click','#pid',doParameterTree);
    })

    function doParameterTree() {
        //显示下拉框
        showTree();
        //初始化zTree数据
        var url = "parameter/doFindZtreeObjects.do";
        //异步加载数据,并初始化数据
        $.getJSON(url, function(result) {
            if (result.state == 1) {
                //使用init函数需要先引入ztree对应的js文件
                zTree = $.fn.zTree.init($("#parameterTree"), setting, result.data);
                zTree.expandAll(true);
            } else {
                alert(result.message);
            }
        })
    }

    function doSXinput() {
        var val=$('input:radio[name="typeId"]:checked').val();
        if (val==2){
            $('#fj').css('display','block');
        }else {
            $('#fj').css('display','none');
        }
    }

    function doHidePage() {
        //隐藏弹框
        $('input:radio[name="typeId"]').get(0).checked=true;
        $('#menuLayer').css('display','none');
        $('#nameId').val("");
        $('#pid').val("");
        $('#ext1').val("");
        //隐藏遮罩层
        hideMask();
    }

    function doFindPageObjects() {
        //显示弹框
        $('#menuLayer').css('display','block');
        $('#menuLayer').css('height',$(document).height()*0.4);
        $('#menuLayer').css('width',$(document).width()*0.6);
        $('.layui-layer-content').css("height",$(document).height()*0.3);
        //判断父级文本框是否显示
        doSXinput();
        //显示遮罩层
        showMask();
    }

    function doFindNull() {
        var trtd="<tr><td colspan='4' align='center'>"+"没有数据"+"</td></tr>";
        var tBody=$("#tbodyId");
        tBody.empty();
        tBody.append(trtd);
    }

    function doFindObjects(id) {
        var ts=0;
        //1.params
        var params={"id":id};
        //2.url
        var url="parameter/doFindObjects.do";
        //3.ajax request
        $.getJSON(url,params,function (result) {
            doHandleResponseResult(result);
            ts=1;
        })
        if (ts==0)
            doFindNull();
    }
    function doHandleResponseResult(result){
        if(result.state==1){
            doSetTableBodyRows(result.data);
        }else{
            doSetTableBodyErrors(result.message);
        }
    }
    function doSetTableBodyErrors(message){
        //获取body对象并清空
        var tBody=$("#tbodyId");
        tBody.empty();
        //创建tr对象
        var tr=$("<tr></tr>");
        //创建td对象
        //var len=$("table thead").find("tr").find("th").length;
        var len=$("table th").length;
        var td=$("<td></td>");
        td.prop("colspan",len);
        td.append(message);
        tr.append(td);
        //将tr追加到tbody
        tBody.append(tr);
    }
    function doSetTableBodyRows(records){

        //获取tbody对象,并清空
        var tBody=$("#tbodyId");
        tBody.empty();
        //2.迭代数据,并追加到tBody
        for(var i in records){
            //2.1构建tr对象
            var tr=$("<tr></tr>");
            tr.data("id",records[i].id);
            //2.2构建tds对象
            var tds=doCreateTds(records[i]);
            //2.3将tds对象追加到tr中
            tr.append(tds);
            //2.4将tr追加到tbody中
            tBody.append(tr);
        }
    }
    function doCreateTds(row){
        var tds=
            "<td><input type='checkbox' name='cItem' class='cItem' value='"+row.id+"'></td>"+
            "<td>"+row.id+"</td>"+
            "<td>"+row.name+"</td>"+
            "<td>"+row.ext1+"</td>"/*+
            "<td><a class='btn-delete label-success'>删除</a>"+
            "&nbsp;<a class='btn-update label-info'>修改</a></td>"*/;
        return tds;
    }

    //节点点击事件
    function zTreeOnClick(event, treeId, treeNode) {
        doFindObjects(treeNode.id);
    }

    function doGetObjects() {
        var url = "parameter/doFindZtreeObjects.do";
        //异步加载数据,并初始化数据
        $.getJSON(url, function(result) {
            if (result.state == 1) {
                //使用init函数需要先引入ztree对应的js文件
                zTree = $.fn.zTree.init($("#zTreeId"), setting, result.data);
                zTree.expandAll(true);
            } else {
                alert(result.message);
            }
        })
    }

    //节点点击事件
    function zTreeOnClick(event, treeId, treeNode) {
        //1.将treeNode数据填充到页面上级菜单对应的表单元素上
        //1.1)节点名字(表单中显示这个值)
        $("#pid").val(treeNode.name);
        //1.2)节点id(进行绑定,此值最后要存储到数据库)
        $("#pid").data("pid",treeNode.id);
        /*alert("选中上级菜单：名称："+$("#parentId").val()+",ID："+$("#parentId").data("parentId"));*/
        //2.隐藏下拉框
        hideTree();
    }
    //下拉框显示 隐藏
    function showTree(){
        if($('.parameterTree').css('display') == 'none'){
            $('.parameterTree').css('display','block');
        } else{
            $('.parameterTree').css('display','none');
        }
        $("body").bind("mousedown", onBodyDownByActionType);
    }
    function hideTree() {
        $('.parameterTree').css('display','none');
        $("body").unbind("mousedown", onBodyDownByActionType);
        return false;
    }
    //区域外点击事件
    function onBodyDownByActionType(event) {
        debugger;
        if (event.target.id.indexOf('parameterTree') == -1){
            if(event.target.id != 'selectDevType'){
                hideTree();
            }
        }
    }

</script>
